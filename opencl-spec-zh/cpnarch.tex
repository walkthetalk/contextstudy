%
% author:	Ni Qingliang
% date:		2011-02-11
%
\startcomponent cpnarch
\environment envcmm
\product opencl
%\starttext

\chapter{OpenCL 架構}

{\ftEmpha OpenCL}是一個開放的工業標準，可以為 CPU、GPU 和其它分離的計算設備（這些設備被組織到同一\cnglo{platform}中）所組成的異構群進行編程。
它不只是一種語言。
OpenCL 是一個並行編程框架，包括一種語言、API、庫和一個運行時系統來支持軟件開發。
例如，使用 OpenCL，程序員可以寫出一個能在 GPU 上執行的通用程序，而不必將其算法映射到 3D 圖形 API （如 OpenGL 或 DirectX）上。

OpenCL 的目標是讓程序員可以寫出可移植並且高效的代碼。
這包括庫作者、中間件供應商、以及要開發高性能應用的程序員。
因此 OpenCL 提供了底層的硬件抽象和一個框架來支持編程，同時也暴露了底層硬件的許多細節。

我們將使用如下的分級模型來描述 OpenCL 背後的核心理念：
\startigBase
\item 平台模型
\item 內存模型
\item 執行模型
\item 編程模型
\stopigBase

\input{chapter_arch/sec_plat_model.tex}
\input{chapter_arch/sec_exe_model.tex}
\input{chapter_arch/sec_mem_model.tex}
\input{chapter_arch/sec_prg_model.tex}

\startbuffer[sectitlememobj]
\cnglo{memobj}
\stopbuffer
\section{\getbuffer[sectitlememobj]}
有两类\cnglo{memobj}：\refglo{bufobj}和\refglo{imgobj}。\refglo{bufobj}中所存储的元素是一维的，而\refglo{imgobj}则用来存储二维或三维的材质、帧缓冲或图像。

\refglo{bufobj}的元素可以是标量数据类型（如int、float）、矢量数据类型、或用户自定义的结构体。\refglo{imgobj}用来表示材质、帧缓冲等buffer。\cnglo{imgobj}中元素的格式必须从预定义格式中选取。一个\cnglo{memobj}中至少要有一个元素。

\refglo{bufobj}和\refglo{imgobj}基本的区别是：
\startigBase
\item \refglo{bufobj}中的元素是顺序存储的，在\cnglo{device}上执行\cnglo{kernel}时，可以使用指针访问它们。而\refglo{imgobj}中元素的存储格式对用户是透明的，不能通过指针直接访问。\scopenclc编程语言提供有内建函数可以用来读写\cnglo{imgobj}。
\item 对于\refglo{bufobj}，\cnglo{kernel}按其存储格式来访问其中的数据。而对于\refglo{imgobj}，其元素的存储格式可能与\cnglo{kernel}中使用的数据格式不一样。在\cnglo{kernel}中，图像元素始终是四元矢量（每一元可以是float或者signed/unsigned integer）。内建函数读取图像元素后会将其转换成四元矢量。类似的，内建函数写入图像时，会将四元矢量转换成恰当的格式（例如，四个8位元素）。
\stopigBase

用{\ftEmpha cl\_mem}来描述\cnglo{memobj}。\cnglo{kernel}会使用\cnglo{memobj}作为其它\cnglo{memobj}的输入或输出。

\section{\scopencl框架}
\scopencl框架允许\cnglo{app}将一个\cnglo{host}与不少于一个的\scopencl\cnglo{device}一起作为一个异构并行计算机系统来使用。这个框架包含以下组件:
\startigBase
\item {\ftEmpha \scopencl平台层：}平台层允许\cnglo{host}\cnglo{program}发现\scopencl\cnglo{device}及其\sccapability并创建\cnglo{context}。
\item {\ftEmpha \scopencl\scruntime：}一旦创建了\cnglo{context}，\scruntime就允许\cnglo{host}\cnglo{program}操控它。
\item {\ftEmpha \scopencl编译器：}\scopencl编译器可以创建包含\scopencl\cnglo{kernel}的可执行程序。它所实现的\scopenclc编程语言支持\scisocnn语言的一个子集，并带有并行扩展。
\stopigBase

\stopcomponent

